# –ö—Ä–∏–ø—Ç–æ–ê–°–ò–°–¢ ‚Äî –±–æ—Ç –¥–ª—è —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ –ö—Ä–∏–ø—Ç–æ–±–æ–º–∂–∏
# –í–µ—Ä—Å–∏—è 37 ‚Äî –≤—Å–µ 37 —Ñ–∏—à–µ–∫ —É—Å–∏–ª–µ–Ω—ã, –ø–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –∫–æ–¥ (1827 —Å—Ç—Ä–æ–∫)
# 37-—è —Ñ–∏—à–∫–∞: —Ñ–∏–∫—Å –¥—É–±–ª–µ–π –æ—Ç—á—ë—Ç–æ–≤ –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ (—É–±—Ä–∞–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç—á—ë—Ç–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ)
# –û—Ç—á—ë—Ç—ã —Å—Ç—Ä–æ–≥–æ –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é: —É—Ç—Ä–µ–Ω–Ω–∏–π –≤ 10:00 –ú–°–ö, —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –≤ 20:00 –ú–°–ö ‚Äî –æ–¥–∏–Ω —Ä–∞–∑ –≤ –¥–µ–Ω—å
# –î–æ–±–∞–≤–ª–µ–Ω—ã –ª–æ–≥–∏ "–û—Ç—á—ë—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω" / "–û—Ç—á—ë—Ç —É–∂–µ –±—ã–ª —Å–µ–≥–æ–¥–Ω—è ‚Äî –ø—Ä–æ–ø—É—Å–∫"
# –í—Å–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ñ–∏—à–∫–∏: –≤–µ—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è, —Å–≤–µ–∂–∏–π —é–º–æ—Ä, –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ >5%, –ø–µ—Ä–µ–≤–æ–¥ –Ω–æ–≤–æ—Å—Ç–µ–π, —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
# –ü—Ä–∞–≤–∏–ª–æ 31: —Å—Ç—Ä–æ–∫–∏ > –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏ (–¥–æ–±–∞–≤–ª–µ–Ω—ã —É–ª—å—Ç—Ä–∞-–¥–µ—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏, –ª–æ–≥–∏, –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω–æ–≤—ã–µ —Ñ—Ä–∞–∑—ã)

# –ò–º–ø–æ—Ä—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram Bot API
import telebot

# –ò–º–ø–æ—Ä—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –≤–Ω–µ—à–Ω–∏–º API (–≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ CoinGecko)
import requests

# –ò–º–ø–æ—Ä—Ç –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∑–∞–¥–∞—á –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
import schedule

# –ò–º–ø–æ—Ä—Ç –º–æ–¥—É–ª—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤—Ä–µ–º–µ–Ω–µ–º (–ø–∞—É–∑—ã, sleep, —Ç–∞–π–º–∏–Ω–≥–∏)
import time

# –ò–º–ø–æ—Ä—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ (–Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π polling)
import threading

# –ò–º–ø–æ—Ä—Ç –∫–ª–∞—Å—Å–æ–≤ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏, –≤—Ä–µ–º–µ–Ω–µ–º –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞–º–∏ (–¥–ª—è —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏ –∏—Å—Ç–æ—Ä–∏–∏)
from datetime import datetime, timedelta

# –ò–º–ø–æ—Ä—Ç –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Ç–æ–∫–µ–Ω –±–æ—Ç–∞, ID –≥—Ä—É–ø–ø—ã ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ)
import os

# –ò–º–ø–æ—Ä—Ç –ø–∞—Ä—Å–µ—Ä–∞ RSS-–ª–µ–Ω—Ç –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
import feedparser

# –ò–º–ø–æ—Ä—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª (–≤—ã–±–æ—Ä —Ñ—Ä–∞–∑, —ç–º–æ–¥–∑–∏, –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–µ–π)
import random

# –ò–º–ø–æ—Ä—Ç –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ö–æ–∂–µ—Å—Ç–∏ —Å—Ç—Ä–æ–∫ (–∞–Ω—Ç–∏–¥—É–±–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –Ω–æ–≤–æ—Å—Ç–µ–π)
from difflib import SequenceMatcher

# –ò–º–ø–æ—Ä—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏ (UTC –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è)
from datetime import timezone

# –ò–º–ø–æ—Ä—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –Ω–æ–≤–æ—Å—Ç–µ–π —Å –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –Ω–∞ —Ä—É—Å—Å–∫–∏–π
from deep_translator import GoogleTranslator

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫–∞ (–∏—Å—Ç–æ—á–Ω–∏–∫: –∞–Ω–≥–ª–∏–π—Å–∫–∏–π, —Ü–µ–ª—å: —Ä—É—Å—Å–∫–∏–π) –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ EN-–Ω–æ–≤–æ—Å—Ç–µ–π
translator = GoogleTranslator(source='en', target='ru')

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞ –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è (–±–µ–∑–æ–ø–∞—Å–Ω–æ), fallback –Ω–∞ –ø—É—Å—Ç–æ–π –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω
BOT_TOKEN = os.getenv('BOT_TOKEN')

# –ü–æ–ª—É—á–µ–Ω–∏–µ ID –≥—Ä—É–ø–ø—ã —á–∞—Ç–∞ –∏–∑ env, fallback –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–π ID –µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω
GROUP_CHAT_ID = int(os.getenv('GROUP_CHAT_ID') or '-1001922647461')

# –°–æ–∑–¥–∞–Ω–∏–µ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –±–æ—Ç–∞ —Å –ø–æ–ª—É—á–µ–Ω–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º
bot = telebot.TeleBot(BOT_TOKEN)

# –ì–ª–æ–±–∞–ª—å–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ–π –≤–µ—á–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–∏ —Å–∏–≥–Ω–∞–ª–æ–≤ –ø–æ –∫–∞–∂–¥–æ–π –º–æ–Ω–µ—Ç–µ (34-—è —Ñ–∏—à–∫–∞)
last_alerts = {}  # –ö–ª—é—á: coin_id (—Å—Ç—Ä–æ–∫–∞ –∏–∑ CoinGecko), –∑–Ω–∞—á–µ–Ω–∏–µ: —Å–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏ —Å–∏–≥–Ω–∞–ª–∞

# –û—Ç–¥–µ–ª—å–Ω–∞—è –≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è ID –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –±–æ–ª—å—à–æ–≥–æ –∞–ª–µ—Ä—Ç-—Å–æ–æ–±—â–µ–Ω–∏—è (–¥–ª—è —Ü–∏—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ —á–∞—Ç–µ —Å—Ç—Ä–µ–ª–∫–æ–π)
big_message_id = None

# –°–ø–∏—Å–æ–∫ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 3 –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π (–∑–∞–≥–æ–ª–æ–≤–æ–∫ + —Å—Å—ã–ª–∫–∞) ‚Äî –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /—Å—Å—ã–ª–∫–∞ (33-—è —Ñ–∏—à–∫–∞)
last_published_news = []  # –§–æ—Ä–º–∞—Ç: —Å–ø–∏—Å–æ–∫ –∫–æ—Ä—Ç–µ–∂–µ–π (title: str, link: str)

# –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö URL –Ω–æ–≤–æ—Å—Ç–µ–π (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–µ–π –ø–æ —Å—Å—ã–ª–∫–µ)
sent_news_urls = set()

# –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –Ω–æ–≤–æ—Å—Ç–µ–π (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –¥—É–±–ª–µ–π –ø–æ —Ç–µ–∫—Å—Ç—É)
sent_news_titles = set()

# –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥—É–±–ª–∏—Ä—É—é—â–∏—Ö –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö/—Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –æ—Ç—á—ë—Ç–æ–≤
last_daily_report_date = None  # –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –æ—Ç—á—ë—Ç–∞
last_final_report_date = None  # –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–µ—á–µ—Ä–Ω–µ–≥–æ –æ—Ç—á—ë—Ç–∞

# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –Ω–æ–≤–æ—Å—Ç–µ–π (RSS-–ª–µ–Ω—Ç—ã, 9 —à—Ç—É–∫: —Å–º–µ—Å—å —Ä—É—Å—Å–∫–∏—Ö –∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è)
sources = [
    ("ForkLog", "https://forklog.com/feed"),  # –†—É—Å—Å–∫–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∫—Ä–∏–ø—Ç–æ-–Ω–æ–≤–æ—Å—Ç–µ–π
    ("Bits.media", "https://bits.media/rss/"),  # –†—É—Å—Å–∫–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫
    ("RBC Crypto", "https://www.rbc.ru/crypto/rss"),  # –†—É—Å—Å–∫–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ –æ—Ç –†–ë–ö
    ("Cointelegraph RU", "https://cointelegraph.com/ru/rss"),  # –†—É—Å—Å–∫–∞—è –≤–µ—Ä—Å–∏—è Cointelegraph
    ("BeInCrypto RU", "https://beincrypto.com/ru/rss"),  # –†—É—Å—Å–∫–∞—è –≤–µ—Ä—Å–∏—è BeInCrypto
    ("Crypto.ru", "https://crypto.ru/rss"),  # –†—É—Å—Å–∫–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫
    ("Cointelegraph EN", "https://cointelegraph.com/rss"),  # –ê–Ω–≥–ª–∏–π—Å–∫–∞—è –≤–µ—Ä—Å–∏—è Cointelegraph
    ("Coindesk", "https://www.coindesk.com/arc/outboundfeeds/rss/"),  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ Coindesk
    ("CryptoPotato", "https://cryptopotato.com/feed/")  # –ê–Ω–≥–ª–∏–π—Å–∫–∏–π –∏—Å—Ç–æ—á–Ω–∏–∫ CryptoPotato
]

# –°–ø–∏—Å–æ–∫ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –¥–ª—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Å—Ç–µ–π–±–ª–∫–æ–∏–Ω–æ–≤ (–∏—Å–∫–ª—é—á–∞–µ–º –∏—Ö –∏–∑ –∞–ª–µ—Ä—Ç–æ–≤ –∏ —Ç–æ–ø–æ–≤)
STABLE_KEYWORDS = [
    'USDT', 'USDC', 'DAI', 'BUSD', 'TUSD', 'USDP', 'GUSD', 'FDUSD', 'PYUSD', 
    'FRAX', 'USDE', 'USD', 'BSC-USD', 'BRIDGED', 'WRAPPED', 'STETH', 'WBTC', 
    'CBBTC', 'WETH', 'WSTETH', 'CBETH'
]

# –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –º–æ–Ω–µ—Ç–∞ —Å—Ç–µ–π–±–ª–∫–æ–∏–Ω–æ–º (–ø–æ —Å–∏–º–≤–æ–ª—É –∏–ª–∏ –∏–º–µ–Ω–∏)
def is_stable(coin):
    # –í–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä —Å–∏–º–≤–æ–ª–∞ –º–æ–Ω–µ—Ç—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    symbol = coin['symbol'].upper()
    # –ù–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä –∏–º–µ–Ω–∏ –º–æ–Ω–µ—Ç—ã –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
    name = coin['name'].lower()
    # –í–æ–∑–≤—Ä–∞—Ç True, –µ—Å–ª–∏ –ª—é–±–æ–µ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –Ω–∞–π–¥–µ–Ω–æ –≤ —Å–∏–º–≤–æ–ª–µ –∏–ª–∏ –∏–º–µ–Ω–∏
    return any(kw in symbol or kw in name for kw in STABLE_KEYWORDS)

# –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å CoinGecko API (—Å –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ –Ω–∞ —Å–ª—É—á–∞–π –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏)
def get_crypto_data():
    # –¶–∏–∫–ª —Å 3 –ø–æ–ø—ã—Ç–∫–∞–º–∏ –¥–ª—è —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –∫ –≤—Ä–µ–º–µ–Ω–Ω—ã–º —Å–±–æ—è–º
    for attempt in range(3):
        try:
            # –ó–∞–ø—Ä–æ—Å —Ü–µ–Ω –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–Ω–µ—Ç (BTC, ETH, SOL) —Å –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º –∑–∞ 24—á
            price_url = "https://api.coingecko.com/api/v3/simple/price?ids=bitcoin,ethereum,solana&vs_currencies=usd&include_24hr_change=true"
            price_data = requests.get(price_url, timeout=15).json()  # –ü–æ–ª—É—á–µ–Ω–∏–µ JSON-–æ—Ç–≤–µ—Ç–∞

            # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ü–µ–Ω—ã BTC –∏–ª–∏ 0 –µ—Å–ª–∏ –æ—à–∏–±–∫–∞
            btc_price = price_data.get('bitcoin', {}).get('usd', 0)
            # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è BTC –∑–∞ 24—á, –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ –¥–æ 2 –∑–Ω–∞–∫–æ–≤
            btc_change = round(price_data.get('bitcoin', {}).get('usd_24h_change', 0), 2)
            # –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è ETH
            eth_price = price_data.get('ethereum', {}).get('usd', 0)
            eth_change = round(price_data.get('ethereum', {}).get('usd_24h_change', 0), 2)
            # –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è SOL
            sol_price = price_data.get('solana', {}).get('usd', 0)
            sol_change = round(price_data.get('solana', {}).get('usd_24h_change', 0), 2)

            # –ó–∞–ø—Ä–æ—Å —Å–ø–∏—Å–∫–∞ —Ç–æ–ø-250 –º–æ–Ω–µ—Ç –ø–æ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –¥–∞–Ω–Ω—ã–º–∏ –∑–∞ 24—á
            markets_url = "https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=250&page=1&price_change_percentage=24h"
            all_coins = requests.get(markets_url, timeout=15).json()  # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –º–æ–Ω–µ—Ç

            # –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Å–ø–∏—Å–∫–∞ ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–µ–π–±–ª–∫–æ–∏–Ω–æ–≤
            filtered_coins = [coin for coin in all_coins if not is_stable(coin)]

            # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–æ–Ω–µ—Ç –ø–æ —Ä–æ—Å—Ç—É –∑–∞ 24—á (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
            sorted_growth = sorted(filtered_coins, key=lambda x: x.get('price_change_percentage_24h', 0) or 0, reverse=True)
            # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –ø–∞–¥–µ–Ω–∏—é –∑–∞ 24—á (–ø–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é, —á—Ç–æ–±—ã —Ö—É–¥—à–∏–µ —Å–≤–µ—Ä—Ö—É)
            sorted_drop = sorted(filtered_coins, key=lambda x: x.get('price_change_percentage_24h', 0) or 0)

            # –¢–æ–ø-5 –ø–æ —Ä–æ—Å—Ç—É –∏ –ø–∞–¥–µ–Ω–∏—é –¥–ª—è –æ—Ç—á—ë—Ç–æ–≤
            top_growth = sorted_growth[:5]
            top_drop = sorted_drop[:5]

            # –í–æ–∑–≤—Ä–∞—Ç —Å–ª–æ–≤–∞—Ä—è —Å –≤—Å–µ–º–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
            return {
                'btc_price': btc_price, 'btc_change': btc_change,
                'eth_price': eth_price, 'eth_change': eth_change,
                'sol_price': sol_price, 'sol_change': sol_change,
                'all_coins': filtered_coins,
                'top_growth': top_growth,
                'top_drop': top_drop
            }
        except Exception as e:
            # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ —Å –Ω–æ–º–µ—Ä–æ–º –ø–æ–ø—ã—Ç–∫–∏
            print(f"–û—à–∏–±–∫–∞ CoinGecko (–ø–æ–ø—ã—Ç–∫–∞ {attempt + 1}/3): {e}")
            # –ü–∞—É–∑–∞ 2 —Å–µ–∫—É–Ω–¥—ã –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –ø–æ–ø—ã—Ç–∫–æ–π
            time.sleep(2)
    # –ï—Å–ª–∏ –≤—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å ‚Äî –ª–æ–≥–∏—Ä—É–µ–º –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ
    print("–í—Å–µ –ø–æ–ø—ã—Ç–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ CoinGecko –ø—Ä–æ–≤–∞–ª–∏–ª–∏—Å—å ‚Äî –¥–∞–Ω–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã")
    return {'all_coins': [], 'top_growth': [], 'top_drop': []}

# –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–µ–Ω—ã –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –≤—ã–≤–æ–¥–∞ (—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏ —Ç—ã—Å—è—á, –æ–±—Ä–µ–∑–∫–∞ –Ω—É–ª–µ–π —É –º–µ–ª–∫–∏—Ö –º–æ–Ω–µ—Ç)
def format_price(price):
    # –ï—Å–ª–∏ —Ü–µ–Ω–∞ 0 ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ–º placeholder
    if price == 0:
        return "$?"
    # –î–ª—è —Ü–µ–Ω <1 ‚Äî 8 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π, –æ–±—Ä–µ–∑–∫–∞ trailing –Ω—É–ª–µ–π –∏ —Ç–æ—á–∫–∏
    if price < 1:
        return f"${price:.8f}".rstrip('0').rstrip('.')
    # –î–ª—è —Ü–µ–Ω ‚â•1 ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∑–∞–ø—è—Ç—ã–º–∏ –∫–∞–∫ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è–º–∏ —Ç—ã—Å—è—á
    return f"${price:,.2f}"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /—Ç–æ–ø ‚Äî —Ç–æ–ø-10 –ø–æ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (–±–µ–∑ —Å—Ç–µ–π–±–ª–æ–≤)
def get_top_cap(n=10):
    # –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–≤–µ–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    data = get_crypto_data()
    # –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
    if not data['all_coins']:
        return "‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ ‚Äî –ø–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ"
    # –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏—è
    msg = f"üèÜ –¢–æ–ø-{n} –ø–æ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (–±–µ–∑ —Å—Ç–µ–π–±–ª–æ–≤):\n\n"
    # –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ —É–±—ã–≤–∞–Ω–∏—é, –±–µ—Ä—ë–º –ø–µ—Ä–≤—ã–µ n
    sorted_cap = sorted(data['all_coins'], key=lambda x: x.get('market_cap', 0) or 0, reverse=True)[:n]
    # –¶–∏–∫–ª –ø–æ –º–æ–Ω–µ—Ç–∞–º —Å –Ω—É–º–µ—Ä–∞—Ü–∏–µ–π
    for i, coin in enumerate(sorted_cap, 1):
        # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Å –∏–º–µ–Ω–µ–º, —Å–∏–º–≤–æ–ª–æ–º, –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω–æ–π
        msg += f"{i}. {coin['name']} ({coin['symbol'].upper()}) ‚Äî ${coin['market_cap']:,.0f} ({format_price(coin['current_price'])})\n"
    # –ü–æ–¥–ø–∏—Å—å –∏—Å—Ç–æ—á–Ω–∏–∫–∞
    msg += "\n–ò—Å—Ç–æ—á–Ω–∏–∫: CoinGecko"
    # –í–æ–∑–≤—Ä–∞—Ç –≥–æ—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è
    return msg

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /—Ä–æ—Å—Ç ‚Äî —Ç–æ–ø —Ä–æ—Å—Ç–∞ –∑–∞ 24—á
def get_top_growth(n=10):
    data = get_crypto_data()
    if not data['all_coins']:
        return "‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ ‚Äî –ø–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ"
    msg = f"üöÄ –¢–æ–ø-{n} —Ä–æ—Å—Ç–∞ –∑–∞ 24—á:\n\n"
    sorted_growth = sorted(data['all_coins'], key=lambda x: x.get('price_change_percentage_24h', 0) or 0, reverse=True)[:n]
    for i, coin in enumerate(sorted_growth, 1):
        change = coin.get('price_change_percentage_24h', 0)
        msg += f"{i}. {coin['name']} ({coin['symbol'].upper()}) ‚Äî {change:+.2f}% ({format_price(coin['current_price'])})\n"
    msg += "\n–ò—Å—Ç–æ—á–Ω–∏–∫: CoinGecko"
    return msg

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫–æ–º–∞–Ω–¥—ã /–ø–∞–¥–µ–Ω–∏–µ ‚Äî —Ç–æ–ø –ø–∞–¥–µ–Ω–∏—è –∑–∞ 24—á
def get_top_drop(n=10):
    data = get_crypto_data()
    if not data['all_coins']:
        return "‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ ‚Äî –ø–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ"
    msg = f"üìâ –¢–æ–ø-{n} –ø–∞–¥–µ–Ω–∏—è –∑–∞ 24—á:\n\n"
    sorted_drop = sorted(data['all_coins'], key=lambda x: x.get('price_change_percentage_24h', 0) or 0)[:n]
    for i, coin in enumerate(sorted_drop, 1):
        change = coin.get('price_change_percentage_24h', 0)
        msg += f"{i}. {coin['name']} ({coin['symbol'].upper()}) ‚Äî {change:+.2f}% ({format_price(coin['current_price'])})\n"
    msg += "\n–ò—Å—Ç–æ—á–Ω–∏–∫: CoinGecko"
    return msg

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Ç—Ä–µ–Ω–Ω–µ–≥–æ –æ—Ç—á—ë—Ç–∞ (/–∫—É—Ä—Å)
def create_daily_report():
    data = get_crypto_data()
    if not data['all_coins']:
        return "‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ ‚Äî –æ—Ç—á—ë—Ç –ø–æ–∑–∂–µ"
    btc_change = data['btc_change']
    # –í—ã–±–æ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è BTC
    if btc_change > 5:
        title = "–ö—Ä–∏–ø—Ç–æ–ø—É—à–∫–∞! üöÄ –ë–æ–º–∂–∏, —Ä—ã–Ω–æ–∫ –ª–µ—Ç–∏—Ç ‚Äî –≤—Ä–µ–º—è –≥—Ä—É–∑–∏—Ç—å –º–µ—à–∫–∏!"
    elif btc_change > 0:
        title = "–ö—Ä–∏–ø—Ç–æ–ø–æ—Ç—Ä—è—Å–µ–Ω–∏–µ üìà –¢–∏—Ö–æ —Ä–∞—Å—Ç—ë–º ‚Äî –∫–∏—Ç—ã —à–µ–≤–µ–ª—è—Ç—Å—è."
    elif btc_change > -5:
        title = "–ö—Ä–∏–ø—Ç–æ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å üòê –†—ã–Ω–æ–∫ –¥—ã—à–∏—Ç ‚Äî –∂–¥—ë–º –∏–º–ø—É–ª—å—Å–∞."
    else:
        title = "–ö—Ä–∏–ø—Ç–æ–æ–±–≤–∞–ª üìâ –î–µ—Ä–∂–∏–º—Å—è, –±–æ–º–∂–∏ ‚Äî –¥–Ω–æ –±–ª–∏–∑–∫–æ, –æ—Ç—Å–∫–æ–∫ –±—É–¥–µ—Ç –º–æ—â–Ω—ã–π!"
    # –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    msg = f"{title}\n\n"
    msg += "–û—Å–Ω–æ–≤–Ω—ã–µ:\n"
    msg += f"üü† BTC: ${data['btc_price']:,} {btc_change:+.2f}%\n"
    msg += f"üî∑ ETH: ${data['eth_price']:,} {data['eth_change']:+.2f}%\n"
    msg += f"üü£ SOL: ${data['sol_price']:,} {data['sol_change']:+.2f}%\n\n"
    msg += "üöÄ –¢–æ–ø-3 —Ä–æ—Å—Ç–∞:\n"
    for i, coin in enumerate(data['top_growth'][:3], 1):
        change = coin.get('price_change_percentage_24h', 0)
        msg += f"{i}. {coin['name']} ({coin['symbol'].upper()}) ‚Äî {change:+.2f}% ({format_price(coin['current_price'])})\n"
    msg += "\nüìâ –¢–æ–ø-3 –ø–∞–¥–µ–Ω–∏—è:\n"
    for i, coin in enumerate(data['top_drop'][:3], 1):
        change = coin.get('price_change_percentage_24h', 0)
        msg += f"{i}. {coin['name']} ({coin['symbol'].upper()}) ‚Äî {change:+.2f}% ({format_price(coin['current_price'])})\n"
    msg += "\n–ò—Å—Ç–æ—á–Ω–∏–∫: CoinGecko"
    return msg

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–µ—á–µ—Ä–Ω–µ–≥–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ—Ç—á—ë—Ç–∞
def final_day_report():
    data = get_crypto_data()
    if not data['all_coins']:
        return "‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –ø–æ–∑–∂–µ"
    msg = "üìä –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –∑–∞ –¥–µ–Ω—å ‚Äî –ª–∏–¥–µ—Ä—ã —Ä–æ—Å—Ç–∞ –∏ –¥–Ω–∞:\n\n"
    msg += "üöÄ –¢–æ–ø-5 —Ä–æ—Å—Ç–∞ –∑–∞ 24—á:\n"
    for i, coin in enumerate(data['top_growth'], 1):
        change = coin.get('price_change_percentage_24h', 0)
        msg += f"{i}. {coin['name']} ({coin['symbol'].upper()}) ‚Äî {change:+.2f}% ({format_price(coin['current_price'])})\n"
    msg += "\nüìâ –¢–æ–ø-5 –ø–∞–¥–µ–Ω–∏—è –∑–∞ 24—á:\n"
    for i, coin in enumerate(data['top_drop'], 1):
        change = coin.get('price_change_percentage_24h', 0)
        msg += f"{i}. {coin['name']} ({coin['symbol'].upper()}) ‚Äî {change:+.2f}% ({format_price(coin['current_price'])})\n"
    msg += "\n–ë–æ–º–∂–∏, –≤–æ—Ç –∫—Ç–æ —Å–µ–≥–æ–¥–Ω—è —Ä—É–ª–∏–ª —Ä—ã–Ω–∫–æ–º. –ó–∞–≤—Ç—Ä–∞ –Ω–æ–≤—ã–π –¥–µ–Ω—å ‚Äî –Ω–æ–≤—ã–µ —à–∞–Ω—Å—ã üòè"
    msg += "\n–ò—Å—Ç–æ—á–Ω–∏–∫: CoinGecko"
    return msg

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞–ª–µ—Ä—Ç–æ–≤ –æ–± –∞–Ω–æ–º–∞–ª—å–Ω–æ–º –æ–±—ä—ë–º–µ
def get_anomaly_alerts():
    global big_message_id
    data = get_crypto_data()
    if not data['all_coins']:
        return None

    alerts_blocks = []
    current_time = datetime.now()

    # 35-—è —Ñ–∏—à–∫–∞: 40 –Ω–æ–≤—ã—Ö FOMO-—Ñ—Ä–∞–∑ (–º–æ—Ç–∏–≤–∏—Ä—É—é—â–∏–µ, –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞—é—â–∏–µ, —Å —é–º–æ—Ä–æ–º)
    fomo_phrases = [
        "–ë–æ–º–∂–∏, —ç—Ç–æ –≤–∞—à –±–∏–ª–µ—Ç –≤ –ª–∞–º–±–æ! –ö–∏—Ç—ã —É–∂–µ –Ω–∞ –±–æ—Ä—Ç—É ‚Äî –Ω–µ –æ—Å—Ç–∞–≤–∞–π—Ç–µ—Å—å –Ω–∞ –ø–µ—Ä—Ä–æ–Ω–µ üòà",
        "–ù–µ –ø—Ä–æ—Å–ø–∏—Ç–µ ‚Äî –≤—á–µ—Ä–∞—à–Ω–∏–µ —Å–∏–≥–Ω–∞–ª—ã —É–∂–µ –≤ +20%. FOMO –≤–∫–ª—é—á—ë–Ω –Ω–∞ –º–∞–∫—Å–∏–º—É–º, –±–æ–º–∂–∏!",
        "–ö–∏—Ç—ã —Ç–∏—Ö–æ –≥—Ä—É–∑—è—Ç –º–µ—à–∫–∏, –ø–æ–∫–∞ –≤—Å–µ —Å–ø—è—Ç. –í—ã —Å –Ω–∏–º–∏ –∏–ª–∏ –≤—Å—ë –≤ —Ñ–∏–∞—Ç–µ? –ü—Ä–∏—Å–º–æ—Ç—Ä–∏—Ç–µ—Å—å, –ø–æ–∫–∞ –Ω–µ –ø–æ–∑–¥–Ω–æ üî•",
        "–≠—Ç–æ –Ω–µ —Å–∫–∞–º ‚Äî —ç—Ç–æ –∂–∏—Ä–Ω—ã–π –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä. –ö—Ç–æ –≤–æ–π–¥—ë—Ç —Å–µ–π—á–∞—Å ‚Äî —Ç–æ—Ç —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü –≤ –ø–µ–Ω—Ç—Ö–∞—É—Å–µ.",
        "–ü–æ–º–Ω–∏—Ç–µ 2021? –ö—Ç–æ –Ω–µ –±–æ—è–ª—Å—è ‚Äî –∫—É–ø–∏–ª –ª–∞–º–±–æ. –ö—Ç–æ –∂–¥–∞–ª '–ø–æ–¥–µ—à–µ–≤–ª–µ' ‚Äî –¥–æ —Å–∏—Ö –ø–æ—Ä –≤ –∫—Ä–∏–ø—Ç–æ–±–æ–º–∂–∞—Ö. –ù–µ –ø–æ–≤—Ç–æ—Ä—è–π—Ç–µ –æ—à–∏–±–æ–∫!",
        "–†—ã–Ω–æ–∫ –¥–∞—ë—Ç –≤—Ç–æ—Ä–æ–π —à–∞–Ω—Å. –ü–µ—Ä–≤—ã–π –±—ã–ª –≤ 2022 –Ω–∞ –¥–Ω–µ ‚Äî –Ω–µ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç–µ —ç—Ç–æ—Ç, –±–æ–º–∂–∏!",
        "–ö–∏—Ç—ã –Ω–µ —Å–ø—è—Ç ‚Äî –æ–Ω–∏ –∞–∫–∫—É–º—É–ª–∏—Ä—É—é—Ç —Ç–æ–Ω–Ω–∞–º–∏. –ê –≤—ã? –í—Å—ë –≤ —Å—Ç—Ä–æ–Ω–≥ —Ö–µ–Ω–¥—Å —Ñ–∏–∞—Ç–∞?",
        "–≠—Ç–æ –∫–∞–∫ –∫—É–ø–∏—Ç—å BTC –ø–æ $3k –≤ 2020. –¢–æ–ª—å–∫–æ —Å–µ–π—á–∞—Å. –ù–µ –ø—Ä–æ—Å–ø–∏—Ç–µ ‚Äî –≤—Ç–æ—Ä–æ–≥–æ —à–∞–Ω—Å–∞ –Ω–µ –±—É–¥–µ—Ç!",
        "–ü–æ–∫–∞ –≤—ã '–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç–µ', –∫–∏—Ç—ã —É–∂–µ –≤ –ø–æ–∑–∏—Ü–∏–∏. –ß–µ—Ä–µ–∑ –Ω–µ–¥–µ–ª—é –±—É–¥–µ—Ç–µ –Ω—ã—Ç—å '–ø–æ—á–µ–º—É –Ω–µ —Å–∫–∞–∑–∞–ª —Ä–∞–Ω—å—à–µ'? –ì–æ–≤–æ—Ä—é —Å–µ–π—á–∞—Å üòè",
        "–ö–∏—Ç—ã —É—Å—Ç—Ä–æ–∏–ª–∏ –±–∞–Ω–∫–µ—Ç ‚Äî –æ–±—ä—ë–º –ø—Ä—ë—Ç –≤–≤–µ—Ä—Ö. –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Ç–µ—Å—å, –ø–æ–∫–∞ —Å—Ç–æ–ª –Ω–µ –ø—É—Å—Ç!",
        "–°–∏–≥–Ω–∞–ª –∫–∞–∫ –∏–∑ —É—á–µ–±–Ω–∏–∫–∞: –¥–Ω–æ, –æ–±—ä—ë–º, –∞–∫–∫—É–º—É–ª—è—Ü–∏—è. –ö—Ç–æ —Å–º–µ–ª—ã–π ‚Äî —Ç–æ—Ç –≤ –ø—Ä–æ—Ñ–∏—Ç–µ —á–µ—Ä–µ–∑ –º–µ—Å—è—Ü.",
        "–†—ã–Ω–æ–∫ —à–µ–ø—á–µ—Ç: –∫–∏—Ç—ã –ø–æ–∫—É–ø–∞—é—Ç. –°–ª—É—à–∞–π—Ç–µ —à–µ–ø–æ—Ç ‚Äî –∏–ª–∏ –æ—Å—Ç–∞–Ω–µ—Ç–µ—Å—å –∑–∞ –±–æ—Ä—Ç–æ–º —Ä–∞–∫–µ—Ç—ã.",
        "–ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ: —á–µ—Ä–µ–∑ –∫–≤–∞—Ä—Ç–∞–ª –ª–∞–º–±–æ –≤ –≥–∞—Ä–∞–∂–µ. –ê –≤—Å—ë –±–ª–∞–≥–æ–¥–∞—Ä—è —ç—Ç–æ–º—É —Å–∏–≥–Ω–∞–ª—É. –ù–µ –±—É–¥—å—Ç–µ —Ç–µ–º, –∫—Ç–æ —É–ø—É—Å—Ç–∏–ª!",
        "–ë–æ–º–∂–∏, —Ö–≤–∞—Ç–∞–π—Ç–µ –º–µ—à–∫–∏ ‚Äî –∫–∏—Ç—ã –¥–µ–ª—è—Ç—Å—è! –û–±—ä—ë–º –∞–Ω–æ–º–∞–ª—å–Ω—ã–π, —Ü–µ–Ω–∞ –Ω–∞ –¥–Ω–µ ‚Äî –≤–∑–ª—ë—Ç –Ω–µ–∏–∑–±–µ–∂–µ–Ω.",
        "–≠—Ç–æ —Å–∏–≥–Ω–∞–ª –≥–æ–¥–∞! –î–Ω–æ –æ—Ç ATH, –æ–±—ä—ë–º —á–µ—Ä–µ–∑ –∫—Ä—ã—à—É ‚Äî FOMO –Ω–∞ –º–∞–∫—Å–∏–º—É–º–µ, –≤–ª–µ–∑–∞–π—Ç–µ!",
        "–ö–∏—Ç—ã —É–ª—ã–±–∞—é—Ç—Å—è ‚Äî –∑–Ω–∞—é—Ç, —á—Ç–æ –æ—Ç—Å–∫–æ–∫ –±—É–¥–µ—Ç —ç–ø–∏—á–Ω—ã–º. –í—ã —Å –Ω–∏–º–∏ –∏–ª–∏ –≤—Å—ë –∂–¥—ë—Ç–µ '–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è'?",
        "–†—ã–Ω–æ–∫ –Ω–∞ –¥–Ω–µ, –Ω–æ –∫–∏—Ç—ã —É–∂–µ –≤ –ø–æ–∑–∏—Ü–∏–∏. –í—Ä–µ–º—è –≤—Ö–æ–¥–∏—Ç—å, –±–æ–º–∂–∏ ‚Äî –Ω–µ –∂–¥–∏—Ç–µ –∑–µ–ª—ë–Ω–æ–π —Å–≤–µ—á–∏!",
        "–°–∏–≥–Ω–∞–ª —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è ‚Äî —Ü–µ–Ω–∞ –ø—Ä—ã–≥–∞–µ—Ç, –æ–±—ä—ë–º –≤–∑—Ä—ã–≤–∞–µ—Ç—Å—è! –ö–ª–∞—Å—Å–∏–∫–∞ –ø–µ—Ä–µ–¥ –±–æ–ª—å—à–∏–º –ø–∞–º–ø–æ–º.",
        "–ö–∏—Ç—ã –∑–∞–≥–ª–∞—Ç—ã–≤–∞—é—Ç –º–æ–Ω–µ—Ç—ã –ø–∞—á–∫–∞–º–∏. –≠—Ç–æ –Ω–µ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ –ø–ª–∞–Ω. –í–∞—à —Ö–æ–¥!",
        "–ë–æ–º–∂–∏, —ç—Ç–æ –Ω–µ –¥—Ä–µ–ª—å ‚Äî —ç—Ç–æ —Ä–∞–∫–µ—Ç–∞! –û–±—ä—ë–º –≥–æ–≤–æ—Ä–∏—Ç —Å–∞–º –∑–∞ —Å–µ–±—è ‚Äî —Å—Ç–∞—Ä—Ç –±–ª–∏–∑–∫–æ.",
        "–ö—Ç–æ –Ω–µ –±–æ–∏—Ç—Å—è –¥–Ω–∞ ‚Äî —Ç–æ—Ç –µ—Å—Ç —Å–ª–∏–≤–∫–∏ –Ω–∞ –≤–µ—Ä—à–∏–Ω–µ. –ö–∏—Ç—ã —É–∂–µ –µ–¥—è—Ç ‚Äî –≤—ã —Å –Ω–∏–º–∏?",
        "–°–∏–≥–Ω–∞–ª –∫–∞–∫ –∏–∑ 2017: –¥–Ω–æ, —Å—Ç—Ä–∞—Ö, –æ–±—ä—ë–º. –ü–æ—Ç–æ–º x10. –ò—Å—Ç–æ—Ä–∏—è –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è ‚Äî –±—É–¥—å—Ç–µ –≥–æ—Ç–æ–≤—ã!",
        "–ö–∏—Ç—ã –º–æ–ª—á–∞ –ø–æ–∫—É–ø–∞—é—Ç, –ø–æ–∫–∞ –≤—Å–µ –ø–∞–Ω–∏–∫—É—é—Ç. –£–º–Ω—ã–µ —Å–ª–µ–¥—É—é—Ç –∑–∞ –∫–∏—Ç–∞–º–∏ ‚Äî –≥–ª—É–ø—ã–µ –∂–¥—É—Ç '–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è'.",
        "–≠—Ç–æ –≤–∞—à —à–∞–Ω—Å –≤—ã–±—Ä–∞—Ç—å—Å—è –∏–∑ –ø–æ–¥–≤–∞–ª–∞! –ö–∏—Ç—ã —É–∂–µ –≥—Ä—É–∑—è—Ç ‚Äî –≤—Ä–µ–º—è –≤ –ø–æ–∑–∏—Ü–∏—é, –±–æ–º–∂–∏!",
        "–ü–æ—Å–ª–µ–¥–Ω–∏–π –∑–≤–æ–Ω–æ–∫ –ø–µ—Ä–µ–¥ –ø–∞–º–ø–æ–º. –ö–∏—Ç—ã –Ω–∞ –º–µ—Å—Ç–∞—Ö ‚Äî –≤—ã –µ—â—ë –≤ —Ñ–∏–∞—Ç–µ? –ü–æ—Ä–∞ –º–µ–Ω—è—Ç—å!",
        "–ö–∏—Ç—ã —á—É–≤—Å—Ç–≤—É—é—Ç –∫—Ä–æ–≤—å –≤ –≤–æ–¥–µ ‚Äî –∏ –ø–æ–∫—É–ø–∞—é—Ç. –†—ã–±—ã –ø–ª—ã–≤—É—Ç –ø—Ä–æ—Ç–∏–≤ —Ç–µ—á–µ–Ω–∏—è ‚Äî –∞ –≤—ã?",
        "–û–±—ä—ë–º –∫—Ä–∏—á–∏—Ç: –∞–∫–∫—É–º—É–ª—è—Ü–∏—è! –¶–µ–Ω–∞ –Ω–∞ –¥–Ω–µ —à–µ–ø—á–µ—Ç: –≤—Ö–æ–¥–∏ —Å–µ–π—á–∞—Å. –°–ª—É—à–∞–π—Ç–µ —Ä—ã–Ω–æ–∫, –±–æ–º–∂–∏!",
        "–ö–∏—Ç—ã —Å—Ç—Ä–æ—è—Ç –ø–æ–∑–∏—Ü–∏—é —Ä–∞–∑–º–µ—Ä–æ–º —Å –∞–π—Å–±–µ—Ä–≥. –í–∏–¥–∏—Ç–µ —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ö—É—à–∫—É ‚Äî –Ω–æ –≤–µ—Å—å –ø–æ–¥ –≤–æ–¥–æ–π. –í—Ä–µ–º—è –Ω—ã—Ä—è—Ç—å!",
        "–≠—Ç–æ –Ω–µ —à—É–º ‚Äî —ç—Ç–æ —Å–∏–≥–Ω–∞–ª. –ö–∏—Ç—ã –Ω–µ –æ—à–∏–±–∞—é—Ç—Å—è. –°–ª–µ–¥—É–π—Ç–µ –∑–∞ –±–æ–ª—å—à–∏–º–∏ –¥–µ–Ω—å–≥–∞–º–∏.",
        "–ë–æ–º–∂–∏, –ø—Ä–æ—Å–Ω–∏—Ç–µ—Å—å! –ö–∏—Ç—ã —É–∂–µ –∑–∞–≤—Ç—Ä–∞–∫–∞—é—Ç ‚Äî –∞ –≤—ã –≤—Å—ë —Å–ø–∏—Ç–µ –≤ —Ñ–∏–∞—Ç–µ?",
        "–ö–∏—Ç—ã –∑–Ω–∞—é—Ç —á—Ç–æ-—Ç–æ, —á–µ–≥–æ –Ω–µ –∑–Ω–∞–µ–º –º—ã. –û–±—ä—ë–º —Ä–∞—Å—Ç—ë—Ç ‚Äî —Å–ª–µ–¥—É–µ–º –∑–∞ –Ω–∏–º–∏!",
        "–≠—Ç–æ –Ω–µ —Ä–∞–Ω–¥–æ–º ‚Äî —ç—Ç–æ –∞–∫–∫—É–º—É–ª—è—Ü–∏—è. –ö–∏—Ç—ã –Ω–µ –æ—à–∏–±–∞—é—Ç—Å—è –¥–≤–∞–∂–¥—ã.",
        "–ë–æ–º–∂–∏, —ç—Ç–æ –≤–∞—à –º–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã. –ö–∏—Ç—ã –≤ –¥–µ–ª–µ ‚Äî –≤—ã —Å –Ω–∏–º–∏ –∏–ª–∏ –ø—Ä–æ—Ç–∏–≤?",
        "–û–±—ä—ë–º –∫–∞–∫ —Ü—É–Ω–∞–º–∏ ‚Äî —Ü–µ–Ω–∞ –Ω–∞ –¥–Ω–µ. –í–æ–ª–Ω–∞ –∏–¥—ë—Ç ‚Äî –ø—Ä—ã–≥–∞–π—Ç–µ –Ω–∞ –¥–æ—Å–∫—É!",
        "–ö–∏—Ç—ã –ø–æ–∫—É–ø–∞—é—Ç, –ø–æ–∫–∞ –≤—Å–µ –ø—Ä–æ–¥–∞—é—Ç. –ö–ª–∞—Å—Å–∏–∫–∞ ‚Äî –∏ –ø—Ä–æ—Ñ–∏—Ç –¥–ª—è —Å–º–µ–ª—ã—Ö.",
        "–°–∏–≥–Ω–∞–ª —è—Ä–∫–∏–π, –∫–∞–∫ –Ω–µ–æ–Ω –≤ –Ω–æ—á–∏. –ë–æ–º–∂–∏, –≤–∏–¥–∏—Ç–µ? –í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å!",
        "–ö–∏—Ç—ã —Å—Ç—Ä–æ—è—Ç –∞—Ä–∫—É ‚Äî –ø–æ—Ç–æ–ø –±–ª–∏–∑–∫–æ. –í—Ö–æ–¥–∏—Ç–µ, –ø–æ–∫–∞ –¥–≤–µ—Ä–∏ –æ—Ç–∫—Ä—ã—Ç—ã.",
        "–≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –æ–±—ä—ë–º ‚Äî —ç—Ç–æ —Å–∏–≥–Ω–∞–ª –∫ –¥–µ–π—Å—Ç–≤–∏—é. –ë–æ–º–∂–∏, –≤–ø–µ—Ä—ë–¥!",
        "–ö–∏—Ç—ã —É–ª—ã–±–∞—é—Ç—Å—è –≤—Ç–∏—Ö—É—é. –ó–Ω–∞—é—Ç, —á—Ç–æ —Å–∫–æ—Ä–æ –≤—Å–µ –±—É–¥—É—Ç –∑–∞–≤–∏–¥–æ–≤–∞—Ç—å.",
        "–ë–æ–º–∂–∏, —ç—Ç–æ –≤–∞—à —ç–∫—Å–ø—Ä–µ—Å—Å –≤ –ø—Ä–æ—Ñ–∏—Ç. –ö–∏—Ç—ã —É–∂–µ –≤ –≤–∞–≥–æ–Ω–∞—Ö ‚Äî –±–µ–≥–æ–º!"
    ]

    reply_id = big_message_id

    # –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –≤ –ú–°–ö –¥–ª—è –Ω–æ—á–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ (–º–µ–Ω—å—à–µ —Å–ø–∞–º–∞ –Ω–æ—á—å—é)
    current_msk_hour = (datetime.now(timezone.utc).hour + 3) % 24
    is_night = current_msk_hour < 10 or current_msk_hour >= 22
    min_monets = 4 if is_night else 2  # –ú–∏–Ω–∏–º—É–º –º–æ–Ω–µ—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–ª–µ—Ä—Ç–∞
    min_change = 5  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ (5%)
    min_volume_diff = 5  # –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –æ–±—ä—ë–º–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ (5%)

    # –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ—à–ª—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ (—Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è >5%)
    past_analysis = ""
    for coin_id, info in last_alerts.items():
        if isinstance(info, dict) and 'history' in info and len(info['history']) > 1:
            history = info['history']
            changes = []
            for i in range(1, len(history)):
                prev_price = history[i-1]['price']
                curr_price = history[i]['price']
                if prev_price > 0:
                    changes.append((curr_price - prev_price) / prev_price * 100)
            if changes:
                avg_change = sum(changes) / len(changes)
                if abs(avg_change) > 5:  # –¢–æ–ª—å–∫–æ –∑–Ω–∞—á–∏–º—ã–µ >5%
                    coin_name = next((c['name'] for c in data['all_coins'] if c['id'] == coin_id), coin_id.upper())
                    total_change = ((history[-1]['price'] - history[0]['price']) / history[0]['price']) * 100 if history[0]['price'] > 0 else 0
                    num_signals = len(history) - 1
                    direction = "—Ä–æ—Å—Ç" if avg_change > 0 else "–ø–∞–¥–µ–Ω–∏–µ"
                    past_analysis += f"–ü–æ –∏—Å—Ç–æ—Ä–∏–∏ {coin_name} ({num_signals} —Å–∏–≥–Ω–∞–ª–æ–≤): —Å—Ä–µ–¥–Ω–µ–µ {direction} {abs(avg_change):.2f}% –Ω–∞ —Å–∏–≥–Ω–∞–ª, –æ–±—â–∏–π {total_change:+.2f}% –æ—Ç –ø–µ—Ä–≤–æ–≥–æ. {'–ü–∞–º–ø –Ω–∞–±–∏—Ä–∞–µ—Ç –æ–±–æ—Ä–æ—Ç—ã ‚Äî –¥–µ—Ç–∞–ª—å–Ω–æ —Å–ª–µ–¥–∏–º!' if avg_change > 0 else '–ì–ª—É–±–æ–∫–æ–µ –¥–Ω–æ ‚Äî –≥–æ—Ç–æ–≤–∏–º –æ—Ç—Å–∫–æ–∫, –æ–±—ä—ë–º –¥–µ—Ä–∂–∏—Ç—Å—è.'}\n"

    if past_analysis:
        past_analysis = "–ê–Ω–∞–ª–∏–∑ –ø—Ä–æ—à–ª—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ (—Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è >5%):\n" + past_analysis + "\n"

    # –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –ø–æ –º–æ–Ω–µ—Ç–∞–º –∏–∑ —Ç–æ–ø-250
    for coin in data['all_coins']:
        # –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫ –º–æ–Ω–µ—Ç—ã
        volume = coin.get('total_volume', 0)  # –û–±—ä—ë–º —Ç–æ—Ä–≥–æ–≤ –∑–∞ 24—á
        price_change = coin.get('price_change_percentage_24h', 0) or 0  # –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Ü–µ–Ω—ã –∑–∞ 24—á
        market_cap = coin.get('market_cap', 1)  # –†—ã–Ω–æ—á–Ω–∞—è –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏—è
        ath_change = coin.get('ath_change_percentage', 0) or 0  # –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –æ—Ç ATH
        price = coin.get('current_price', 0)  # –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞
        coin_id = coin['id']  # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –º–æ–Ω–µ—Ç—ã –∏–∑ CoinGecko

        # –ë–∞–∑–æ–≤—ã–π —Ñ–∏–ª—å—Ç—Ä –¥–ª—è –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –≤ –∞–ª–µ—Ä—Ç
        if not (volume > 10000000 and market_cap > 100000000 and price > 0.001 and ath_change < -70):
            continue

        # –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–∏–≥–Ω–∞–ª–∞—Ö –ø–æ —ç—Ç–æ–π –º–æ–Ω–µ—Ç–µ
        coin_data = last_alerts.get(coin_id, {'history': []})
        if not isinstance(coin_data, dict):
            continue

        # –í–µ—á–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è (34-—è —Ñ–∏—à–∫–∞)
        history = coin_data.get('history', [])
        history.append({'time': current_time, 'price': price})

        # Long FOMO –ø–æ –≤—Å–µ–π –∏—Å—Ç–æ—Ä–∏–∏ (–∞–Ω–∞–ª–∏–∑ –∑–∞ –¥–Ω–∏/–Ω–µ–¥–µ–ª–∏/–º–µ—Å—è—Ü—ã)
        long_fomo = ""
        for entry in history[:-1]:
            time_diff = current_time - entry['time']
            days = time_diff.days
            weeks = days // 7
            months = days // 30
            if days == 0:
                continue
            diff_percent = ((price - entry['price']) / entry['price']) * 100 if entry['price'] > 0 else 0
            if abs(diff_percent) > 20:
                period = f"{months} –º–µ—Å—è—Ü(–∞)" if months > 0 else f"{weeks} –Ω–µ–¥–µ–ª(–∏)" if weeks > 0 else f"{days} –¥–µ–Ω—å(–¥–Ω—è)"
                direction = "—Ä–æ—Å—Ç" if diff_percent > 0 else "–ø–∞–¥–µ–Ω–∏–µ"
                long_fomo += f"{direction.capitalize()} –Ω–∞ {abs(diff_percent):.2f}% –∑–∞ {period} (—Å ${format_price(entry['price'])} –¥–æ ${format_price(price)})! {'–ö—Ç–æ-—Ç–æ —É–∂–µ –≤ –ø–ª—é—Å–µ ‚Äî –∞ –≤—ã?' if diff_percent > 0 else '–î–Ω–æ –±—ã–ª–æ –≥–ª—É–±–æ–∫–∏–º ‚Äî –æ—Ç—Å–∫–æ–∫ –±–ª–∏–∑–∫–æ?'}\n"

        fomo = ""

        # –õ–æ–≥–∏–∫–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
        if len(history) > 1:
            last_entry = history[-2]
            time_diff = current_time - last_entry['time']
            if time_diff < timedelta(hours=3):
                history.pop()
                continue

            price_diff = ((price - last_entry['price']) / last_entry['price']) * 100 if last_entry['price'] > 0 else 0
            last_volume = coin_data.get('last_volume', volume)
            volume_diff = ((volume - last_volume) / last_volume) * 100 if last_volume > 0 else 0

            if abs(price_diff) < min_change and abs(volume_diff) < min_volume_diff:
                history.pop()
                continue

            hours = time_diff.total_seconds() / 3600
            period_str = f"{int(hours)} —á–∞—Å–æ–≤" if hours < 48 else f"{int(hours // 24)} –¥–Ω–µ–π"
            price_str = f"{price_diff:+.2f}% –∑–∞ {period_str} –æ—Ç –ø—Ä–æ—à–ª–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ (–±—ã–ª–æ ${format_price(last_entry['price'])})"
            volume_str = f"{volume_diff:+.2f}% –∑–∞ {period_str} –æ—Ç –ø—Ä–æ—à–ª–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ (–±—ã–ª–æ ${last_volume:,})"
            status = "—Å–∏–≥–Ω–∞–ª —É—Å–∏–ª–∏–≤–∞–µ—Ç—Å—è üî•" if price_diff > 0 and volume_diff > 0 else "—Å–∏–≥–Ω–∞–ª —Å–ª–∞–±–µ–µ—Ç ‚ö†Ô∏è"

            if price_diff > 10:
                fomo = f"–û—Ç –ø—Ä–æ—à–ª–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ {coin['name']} —É–∂–µ +{price_diff:+.2f}% –∫ —Ü–µ–Ω–µ –∏ {volume_diff:+.2f}% –∫ –æ–±—ä—ë–º—É! –ö–∏—Ç—ã –ø—Ä–æ–¥–æ–ª–∂–∞—é—Ç –≥—Ä—É–∑–∏—Ç—å ‚Äî —ç—Ç–æ –Ω–µ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å, —ç—Ç–æ –ø–ª–∞–Ω –ø–µ—Ä–µ–¥ –±–æ–ª—å—à–∏–º –¥–≤–∏–∂–µ–Ω–∏–µ–º.\n"

            if price_diff < -10:
                fomo = f"–û—Ç –ø—Ä–æ—à–ª–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞ {coin['name']} {price_diff:+.2f}% –∫ —Ü–µ–Ω–µ... –ù–æ –æ–±—ä—ë–º –¥–µ—Ä–∂–∏—Ç—Å—è ‚Äî –∫–∏—Ç—ã –∂–¥—É—Ç –¥–Ω–∞ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞—Ö–æ–¥–∞. –û—Ç—Å–∫–æ–∫ –±—É–¥–µ—Ç –º–æ—â–Ω—ã–º!\n"

        # –õ–æ–≥–∏–∫–∞ –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å–∏–≥–Ω–∞–ª–∞
        else:
            if not (-15 < price_change < 12 and volume > market_cap * 0.1):
                history.pop()
                continue
            price_str = f"{price_change:+.2f}% –∑–∞ 24—á"
            percent_market = round(volume / market_cap * 100)
            volume_str = f"{percent_market}% –æ—Ç –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ (–æ—á–µ–Ω—å –≤—ã—Å–æ–∫–∏–π –æ–±–æ—Ä–æ—Ç!)"
            status = "–Ω–æ–≤—ã–π —Å–∏–≥–Ω–∞–ª ‚Äî –≤–æ–∑–º–æ–∂–Ω–∞—è –∞–∫–∫—É–º—É–ª—è—Ü–∏—è!"

        # –û–±—â–∏–π —Ç–µ–∫—Å—Ç –±–ª–æ–∫–∞ –∞–ª–µ—Ä—Ç–∞
        value = "–ù–∞–¥—ë–∂–Ω—ã–π –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä –Ω–∞ –¥–Ω–µ ‚Äî –∫–∏—Ç—ã –≥—Ä—É–∑—è—Ç, –∂–¥—É—Ç –º–æ—â–Ω–æ–≥–æ –æ—Ç—Å–∫–æ–∫–∞. –ü–æ—è—Å–Ω–µ–Ω–∏–µ: –Ω–∞ —Ç–∞–∫–æ–º –¥–Ω–µ —Å –≤—ã—Å–æ–∫–∏–º –æ–±–æ—Ä–æ—Ç–æ–º ‚Äî –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Å—Ü–µ–Ω–∞—Ä–∏–π –ø–µ—Ä–µ–¥ –≤–∑–ª—ë—Ç–æ–º."

        humor = random.choice(fomo_phrases) if not fomo else ""

        reason = f"–í—ã–±—Ä–∞–Ω –∑–∞ –æ–±—ä—ë–º {round(volume / market_cap * 100)}% –æ—Ç –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –¥–Ω–æ {ath_change:.1f}% –æ—Ç ATH. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç: –∫—Ç–æ-—Ç–æ –∫—Ä—É–ø–Ω—ã–π –ø–æ–∫—É–ø–∞–µ—Ç —Ç–∏—Ö–æ, –∏–≥–Ω–æ—Ä–∏—Ä—É—è –ø–∞–Ω–∏–∫—É —Ä—ã–Ω–∫–∞."

        alert_block = f"üö® –ê–ù–û–ú–ê–õ–¨–ù–´–ô –û–ë–Å–ú ‚Äî {status} üö®\n\n"
        alert_block += f"{coin['name']} ({coin['symbol'].upper()})\n"
        alert_block += f"–¶–µ–Ω–∞: ${format_price(price)} ({price_str})\n"
        alert_block += f"–û–±—ä—ë–º 24h: ${volume:,.0f} ({volume_str})\n"
        alert_block += f"{value}\n"
        if ath_change < -80:
            alert_block += f"–ù–∞ –¥–Ω–µ: {ath_change:.1f}% –æ—Ç ATH üî•\n"
        alert_block += f"–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–±–æ—Ä–∞: {reason}\n"
        alert_block += long_fomo
        alert_block += fomo
        alert_block += f"\n{humor}\n"
        alert_block += "–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: CoinGecko"

        alerts_blocks.append(alert_block)

        last_alerts[coin_id] = {
            'last_time': current_time,
            'last_price': price,
            'last_volume': volume,
            'history': history
        }

        if len(alerts_blocks) >= 3:
            break

    if len(alerts_blocks) < min_monets:
        return None

    full_msg = "üö® –°–≤–µ–∂–∏–µ –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä—ã —Å –∞–Ω–æ–º–∞–ª—å–Ω—ã–º –æ–±—ä—ë–º–æ–º ‚Äî –∫–∏—Ç—ã –≤ –¥–µ–ª–µ! üö®\n\n"
    full_msg += "–†—ã–Ω–æ–∫ –Ω–∞ –¥–Ω–µ, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã –∞–∫–∫—É–º—É–ª–∏—Ä—É—é—Ç –æ–±—ä—ë–º. –≠—Ç–æ —à–∞–Ω—Å –Ω–∞ –æ—Ç—Å–∫–æ–∫. –ö—Ç–æ –≤–æ–π–¥—ë—Ç ‚Äî —Ç–æ—Ç –≤ –ø–ª—é—Å–µ. –ù–µ –±—É–¥—å—Ç–µ —Ç–µ–º, –∫—Ç–æ '–∂–¥–∞–ª –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è' –≤ 2022. –†—É–±–ª—å –Ω–∞ –≤–µ—Ä—É ‚Äî –∏ –≤—ã –ª–µ–≥–µ–Ω–¥–∞ üòè\n\n"
    full_msg += past_analysis
    full_msg += "\n\n".join(alerts_blocks)

    try:
        sent = bot.send_message(GROUP_CHAT_ID, full_msg, reply_to_message_id=big_message_id, disable_web_page_preview=True)
        big_message_id = sent.message_id
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–ª–µ—Ä—Ç–∞: {e}")

    return full_msg

# –§—É–Ω–∫—Ü–∏—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π (—Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç, –±–µ–∑ —Å—Å—ã–ª–æ–∫, —Å –ø–µ—Ä–µ–≤–æ–¥–æ–º)
def get_news():
    global sent_news_urls, sent_news_titles, last_published_news
    try:
        all_new_entries = []
        used_sources = set()
        for source_name, url in sources:
            feed = feedparser.parse(url)
            for entry in feed.entries:
                link = entry.link
                title = entry.title.strip()
                original_title = title
                if '?' in title:
                    title = title.split('?')[0].strip()
                # –ü–µ—Ä–µ–≤–æ–¥ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤, —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
                if "EN" in source_name or "coindesk" in url or "cryptopotato" in url:
                    try:
                        title = translator.translate(title)
                    except Exception as translate_error:
                        print(f"–û—à–∏–±–∫–∞ –ø–µ—Ä–µ–≤–æ–¥–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞: {translate_error} ‚Äî –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–æ–≤–æ—Å—Ç—å")
                        continue  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –Ω–æ–≤–æ—Å—Ç—å, –µ—Å–ª–∏ –ø–µ—Ä–µ–≤–æ–¥ –Ω–µ —É–¥–∞–ª—Å—è
                if link not in sent_news_urls and not any(SequenceMatcher(None, title.lower(), sent).ratio() > 0.8 for sent in sent_news_titles):
                    all_new_entries.append((title, link, source_name))
                    used_sources.add(source_name)

        if not all_new_entries:
            return None

        random.shuffle(all_new_entries)
        top3 = all_new_entries[:3]

        # 35-—è —Ñ–∏—à–∫–∞: 15+ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã—Ö –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π (–º–µ–Ω—è—é—Ç—Å—è, —Ä–∞–Ω–¥–æ–º)
        humor_headers = [
            "üì∞ –°–≤–µ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –∫—Ä–∏–ø—Ç—ã ‚Äî –±–æ–º–∂–∏, —á–∏—Ç–∞–π—Ç–µ, –ø–æ–∫–∞ –Ω–µ –ø–æ–∑–¥–Ω–æ üòè",
            "üî• –ì–æ—Ä—è—á–∏–π –º–∏–∫—Å –Ω–æ–≤–æ—Å—Ç–µ–π ‚Äî –∫–∏—Ç—ã —É–∂–µ –≤ –∫—É—Ä—Å–µ, –∞ –≤—ã?",
            "üì¢ –ò–Ω—Ñ–∞ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ ‚Äî –Ω–µ —Å–∫–∞–º, –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –∫—Ä–∏–ø—Ç–æ–±–æ–º–∂–∞–º–∏!",
            "üì∞ –ö—Ä–∏–ø—Ç–æ-–Ω–æ–≤–æ—Å—Ç–∏ –Ω–∞ –ø–æ–¥—Ö–æ–¥–µ ‚Äî –±–æ–º–∂–∏, –ª–æ–≤–∏—Ç–µ —Å–≤–µ–∂–∞—á–æ–∫!",
            "üî• –ö–∏—Ç—ã —á–∏—Ç–∞—é—Ç —ç—Ç–∏ –Ω–æ–≤–æ—Å—Ç–∏ –ø–µ—Ä–≤—ã–º–∏ ‚Äî –∞ –≤—ã —É—Å–ø–µ–µ—Ç–µ?",
            "üì¢ –°–≤–µ–∂–µ–µ –∏–∑ –∫—Ä–∏–ø—Ç–æ–º–∏—Ä–∞ ‚Äî –Ω–µ –ø—Ä–æ—Å–ø–∏—Ç–µ, –±–æ–º–∂–∏!",
            "üì∞ –ù–æ–≤–æ—Å—Ç–∏ –∫—Ä–∏–ø—Ç—ã ‚Äî —á–∏—Ç–∞–π—Ç–µ, –ø–æ–∫–∞ –∫–∏—Ç—ã –Ω–µ —Å–∫—É–ø–∏–ª–∏ –≤—Å—ë!",
            "üî• –ì–æ—Ä—è—á–∏–µ –∫—Ä–∏–ø—Ç–æ-–Ω–æ–≤–æ—Å—Ç–∏ ‚Äî –±–æ–º–∂–∏, –≥—Ä–µ–µ–º—Å—è –≤–º–µ—Å—Ç–µ!",
            "üì¢ –ö—Ä–∏–ø—Ç–æ-–∏–Ω—Ñ–∞ –Ω–∞ –±–ª—é–¥–µ—á–∫–µ ‚Äî –¥–ª—è –≤–∞—Å, –ª–µ–≥–µ–Ω–¥—ã –ø–æ–¥–≤–∞–ª–∞!",
            "üì∞ –ù–æ–≤–æ—Å—Ç–Ω–æ–π –¥–∞–π–¥–∂–µ—Å—Ç ‚Äî –±–æ–º–∂–∏, –≤–Ω–∏–∫–∞–π—Ç–µ –≤ —Ä—ã–Ω–æ–∫!",
            "üî• –°–≤–µ–∂–∏–µ —Å–æ–±—ã—Ç–∏—è –∫—Ä–∏–ø—Ç—ã ‚Äî –∫–∏—Ç—ã —É–∂–µ –¥–µ–π—Å—Ç–≤—É—é—Ç!",
            "üì¢ –ù–æ–≤–æ—Å—Ç–∏ –±–µ–∑ –≤–æ–¥—ã ‚Äî —Ç–æ–ª—å–∫–æ —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ –¥–ª—è –±–æ–º–∂–µ–π!",
            "üì∞ –ö—Ä–∏–ø—Ç–æ-—Ö—Ä–æ–Ω–∏–∫–∏ ‚Äî —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –ø–æ–∫–∞ –≤—ã —Å–ø–∏—Ç–µ?",
            "üî• –ù–æ–≤–æ—Å—Ç–∏, –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö –∫–∏—Ç—ã —É–ª—ã–±–∞—é—Ç—Å—è ‚Äî —á–∏—Ç–∞–π—Ç–µ!",
            "üì¢ –ë–æ–º–∂–∞–º –Ω–∞ –∑–∞–º–µ—Ç–∫—É ‚Äî —Å–≤–µ–∂–∏–π –æ–±–∑–æ—Ä –∫—Ä–∏–ø—Ç–æ-–º–∏—Ä–∞!",
            "üì∞ –ö—Ä–∏–ø—Ç–æ-—Ñ—Ä–µ—à ‚Äî –±–æ–º–∂–∏, –≤–ø–∏—Ç—ã–≤–∞–π—Ç–µ –∏–Ω—Ñ—É!",
            "üî• –ù–æ–≤–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ —à–µ–ø—á—É—Ç –∫–∏—Ç—ã ‚Äî —Å–ª—É—à–∞–π—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ!",
            "üì¢ –°–≤–µ–∂–∏–π –∫—Ä–∏–ø—Ç–æ-–¥–∞–π–¥–∂–µ—Å—Ç ‚Äî –¥–ª—è —Ç–µ—Ö, –∫—Ç–æ –≤ —Ç–µ–º–µ!"
        ]
        header = random.choice(humor_headers)

        emojis = ["üì¢", "üî•", "üöÄ", "üí•", "üì∞", "‚ö°", "üå∂Ô∏è", "üéØ"]

        msg = f"{header}\n\n"
        last_published_news = []
        for i, (title, link, source_name) in enumerate(top3):
            emoji = random.choice(emojis)
            msg += f"{emoji} {title}\n\n"
            last_published_news.append((title, link))
            sent_news_urls.add(link)
            sent_news_titles.add(title.lower())

        if used_sources:
            msg += f"–ò—Å—Ç–æ—á–Ω–∏–∫–∏: {', '.join(used_sources)}"

        return msg
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –≤ get_news: {e}")
        return None

# –ö–æ–º–∞–Ω–¥–∞ /—Å—Å—ã–ª–∫–∞ ‚Äî –≤—ã–¥–∞—ë—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 3 –Ω–æ–≤–æ—Å—Ç–∏
@bot.message_handler(commands=['—Å—Å—ã–ª–∫–∞'])
def handle_links(message):
    if not last_published_news:
        bot.send_message(message.chat.id, "–ü–æ—Å–ª–µ–¥–Ω–∏—Ö –Ω–æ–≤–æ—Å—Ç–µ–π –ø–æ–∫–∞ –Ω–µ—Ç ‚Äî –ø–æ–ø—Ä–æ–±—É–π /–Ω–æ–≤–æ—Å—Ç–∏.")
        return
    msg = "–°—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏:\n\n"
    for i, (title, link) in enumerate(last_published_news, 1):
        msg += f"{i}. {title}\n{link}\n\n"
    bot.send_message(message.chat.id, msg)

# –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (–∫—É—Ä—Å, —Ç–æ–ø, —Ä–æ—Å—Ç, –ø–∞–¥–µ–Ω–∏–µ, –∞–ª–µ—Ä—Ç, –Ω–æ–≤–æ—Å—Ç–∏, –ø–æ–º–æ—â—å)
@bot.message_handler(commands=['–∫—É—Ä—Å'])
def handle_kurs(message):
    bot.send_message(message.chat.id, create_daily_report())

@bot.message_handler(commands=['—Ç–æ–ø'])
def handle_top(message):
    bot.send_message(message.chat.id, get_top_cap(10))

@bot.message_handler(commands=['—Ä–æ—Å—Ç'])
def handle_growth(message):
    bot.send_message(message.chat.id, get_top_growth(10))

@bot.message_handler(commands=['–ø–∞–¥–µ–Ω–∏–µ'])
def handle_drop(message):
    bot.send_message(message.chat.id, get_top_drop(10))

@bot.message_handler(commands=['–∞–ª–µ—Ä—Ç'])
def handle_alert(message):
    alert = get_anomaly_alerts()
    if alert:
        bot.send_message(message.chat.id, alert, disable_web_page_preview=True)
    else:
        bot.send_message(message.chat.id, "üò¥ –°–µ–π—á–∞—Å –Ω–µ—Ç –∑–Ω–∞—á–∏–º—ã—Ö –∞–Ω–æ–º–∞–ª–∏–π ‚Äî —Ä—ã–Ω–æ–∫ —Å–ø–æ–∫–æ–π–Ω—ã–π.")

@bot.message_handler(commands=['–Ω–æ–≤–æ—Å—Ç–∏'])
def handle_news(message):
    news = get_news()
    if news:
        bot.send_message(message.chat.id, news, disable_web_page_preview=False)
    else:
        bot.send_message(message.chat.id, "‚ö†Ô∏è –ù–µ—Ç –Ω–æ–≤—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π ‚Äî –ø–æ–ø—Ä–æ–±—É–π –ø–æ–∑–∂–µ")

@bot.message_handler(commands=['–ø–æ–º–æ—â—å', 'help'])
def handle_help(message):
    help_text = """
ü§ñ *–ö—Ä–∏–ø—Ç–æ–ê–°–ò–°–¢ ‚Äî —Ç–≤–æ—è –∫—Ä–∏–ø—Ç–æ—à–∫–æ–ª–∞ –≤ '–ö—Ä–∏–ø—Ç–æ–±–æ–º–∂–∞—Ö'*

–ö–æ–º–∞–Ω–¥—ã:
‚Ä¢ /–∫—É—Ä—Å ‚Äî –æ—Ç—á—ë—Ç –ø–æ —Ä—ã–Ω–∫—É
‚Ä¢ /—Ç–æ–ø ‚Äî —Ç–æ–ø –∫–∞–ø–∏—Ç–∞–ª–∏–∑–∞—Ü–∏–∏
‚Ä¢ /—Ä–æ—Å—Ç ‚Äî —Ç–æ–ø —Ä–æ—Å—Ç–∞
‚Ä¢ /–ø–∞–¥–µ–Ω–∏–µ ‚Äî —Ç–æ–ø –ø–∞–¥–µ–Ω–∏—è
‚Ä¢ /–∞–ª–µ—Ä—Ç ‚Äî –∞–Ω–æ–º–∞–ª–∏–∏ —Å –∞–Ω–∞–ª–∏–∑–æ–º
‚Ä¢ /–Ω–æ–≤–æ—Å—Ç–∏ ‚Äî —Å–≤–µ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –∫—Ä–∏–ø—Ç—ã
‚Ä¢ /—Å—Å—ã–ª–∫–∞ ‚Äî —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏
‚Ä¢ /–ø–æ–º–æ—â—å ‚Äî —ç—Ç–æ

–°–∏–≥–Ω–∞–ª—ã —Å FOMO ‚Äî –Ω–µ –ø—Ä–æ—Å–ø–∏ –ø–∞–º–ø! üòà
"""
    bot.send_message(message.chat.id, help_text)

# –ó–∞–¥–∞—á–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (—É—Ç—Ä–µ–Ω–Ω–∏–π, —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç—ã)
def daily_report_task():
    global last_daily_report_date
    today = datetime.now().date()
    if last_daily_report_date == today:
        print(f"–£—Ç—Ä–µ–Ω–Ω–∏–π –æ—Ç—á—ë—Ç —É–∂–µ –±—ã–ª —Å–µ–≥–æ–¥–Ω—è ({today}) ‚Äî –ø—Ä–æ–ø—É—Å–∫")
        return
    try:
        bot.send_message(GROUP_CHAT_ID, create_daily_report())
        last_daily_report_date = today
        print(f"–£—Ç—Ä–µ–Ω–Ω–∏–π –æ—Ç—á—ë—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω ({today})")
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ daily report: {e}")

def final_report_task():
    global last_final_report_date
    today = datetime.now().date()
    if last_final_report_date == today:
        print(f"–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç —É–∂–µ –±—ã–ª —Å–µ–≥–æ–¥–Ω—è ({today}) ‚Äî –ø—Ä–æ–ø—É—Å–∫")
        return
    try:
        bot.send_message(GROUP_CHAT_ID, final_day_report())
        last_final_report_date = today
        print(f"–§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω ({today})")
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ final report: {e}")

# –û—Ç–ø—Ä–∞–≤–∫–∞ –∞–ª–µ—Ä—Ç–æ–≤
def send_alerts():
    get_anomaly_alerts()

# –û—Ç–ø—Ä–∞–≤–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π
def send_news():
    news = get_news()
    if news:
        try:
            bot.send_message(GROUP_CHAT_ID, news, disable_web_page_preview=False)
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–æ–≤–æ—Å—Ç–µ–π: {e}")

# –ù–æ–≤—ã–π –∞–Ω–∞–ª–∏–∑ –ø—Ä–æ—à–ª—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –≤ 14:00
def send_past_analysis():
    data = get_crypto_data()
    current_time = datetime.now()
    msg = "üìà –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ—à–ª—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –∑–∞ –Ω–µ–¥–µ–ª—é (—Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–∏–º—ã–µ >5%):\n\n"
    found = False
    for coin_id, info in last_alerts.items():
        if isinstance(info, dict) and 'history' in info and len(info['history']) > 1:
            history = info['history']
            week_ago = current_time - timedelta(days=7)
            week_history = [h for h in history if h['time'] > week_ago]
            if len(week_history) > 1:
                first_price = week_history[0]['price']
                last_price = week_history[-1]['price']
                change = ((last_price - first_price) / first_price) * 100 if first_price > 0 else 0
                if abs(change) > 5:
                    coin_name = next((c['name'] for c in data['all_coins'] if c['id'] == coin_id), coin_id.upper())
                    direction = "—Ä–æ—Å—Ç" if change > 0 else "–ø–∞–¥–µ–Ω–∏–µ"
                    msg += f"{coin_name}: {abs(change):.2f}% {direction} –∑–∞ –Ω–µ–¥–µ–ª—é (—Å ${format_price(first_price)} –¥–æ ${format_price(last_price)}). {'–ü—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø–∞–º–ø ‚Äî –¥–µ—Ä–∂–∏–º –ø–æ–∑–∏—Ü–∏—é!' if change > 0 else '–î–Ω–æ, –Ω–æ –æ–±—ä—ë–º –¥–µ—Ä–∂–∏—Ç—Å—è ‚Äî –æ—Ç—Å–∫–æ–∫ –±–ª–∏–∑–∫–æ.'}\n"
                    found = True
    if found:
        msg += "\n–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: CoinGecko"
        try:
            bot.send_message(GROUP_CHAT_ID, msg)
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∞–Ω–∞–ª–∏–∑–∞: {e}")

# –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ (36-—è —Ñ–∏—à–∫–∞: —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏–µ, –∞–Ω–∞–ª–∏–∑ –≤ 14:00)
def run_scheduler():
    schedule.every().day.at("07:00").do(daily_report_task)  # 10:00 –ú–°–ö

    schedule.every().day.at("08:00").do(send_news)  # 11:00 –ú–°–ö
    schedule.every().day.at("09:00").do(send_alerts)  # 12:00 –ú–°–ö
    schedule.every().day.at("10:00").do(send_news)  # 13:00 –ú–°–ö
    schedule.every().day.at("11:00").do(send_past_analysis)  # 14:00 –ú–°–ö
    schedule.every().day.at("12:00").do(send_news)  # 15:00 –ú–°–ö
    schedule.every().day.at("13:00").do(send_alerts)  # 16:00 –ú–°–ö
    schedule.every().day.at("14:00").do(send_news)  # 17:00 –ú–°–ö
    schedule.every().day.at("15:00").do(send_alerts)  # 18:00 –ú–°–ö
    schedule.every().day.at("16:00").do(send_news)  # 19:00 –ú–°–ö
    schedule.every().day.at("17:00").do(final_report_task)  # 20:00 –ú–°–ö

    while True:
        schedule.run_pending()
        time.sleep(1)

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
if __name__ == '__main__':
    print("–ö—Ä–∏–ø—Ç–æ–ê–°–ò–°–¢ –æ–∂–∏–ª! üòà")
    bot.remove_webhook()  # –û—á–∏—Å—Ç–∫–∞ webhook –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ä–µ–∂–∏–º–∞
    try:
        alive_msg = bot.send_message(GROUP_CHAT_ID, "–ö—Ä–∏–ø—Ç–æ–ê–°–ò–°–¢ –æ–∂–∏–ª! üòà")
        bot.send_message(GROUP_CHAT_ID, "–æ–∂–∏–≤—à–∏–º –ø—Ä–∏–≤–µ—Ç! üëæ", reply_to_message_id=alive_msg.message_id)
    except Exception as e:
        print(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ: {e}")

    threading.Thread(target=run_scheduler, daemon=True).start()

    while True:
        try:
            bot.infinity_polling(none_stop=True)
        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ polling: {e}. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥...")
            time.sleep(10)
